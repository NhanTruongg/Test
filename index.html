<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>T·∫°o & T·∫£i GIF Ngay</title>
  <script src="https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; padding: 20px; background: #f4f4f4; }
    canvas { border: 2px solid #333; border-radius: 10px; margin: 20px auto; display: block; }
    button {
      padding: 12px 24px;
      font-size: 18px;
      margin: 10px;
      cursor: pointer;
      background: #e74c3c;
      color: white;
      border: none;
      border-radius: 8px;
    }
    button:disabled { background: #ccc; cursor: not-allowed; }
    .progress { width: 300px; height: 10px; background: #eee; margin: 20px auto; border-radius: 5px; overflow: hidden; }
    .bar { height: 100%; width: 0%; background: #27ae60; transition: width 0.1s; }
  </style>
</head>
<body>
  <h1>üé¨ T·∫°o GIF t·ª´ Animation & T·∫£i Ngay</h1>
  <canvas id="canvas" width="400" height="300"></canvas>
  
  <div>
    <button id="start">B·∫Øt ƒë·∫ßu t·∫°o GIF</button>
    <button id="download" disabled>‚¨áÔ∏è T·∫£i GIF v·ªÅ</button>
  </div>

  <div class="progress"><div class="bar" id="bar"></div></div>
  <p id="status">S·∫µn s√†ng...</p>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('start');
    const downloadBtn = document.getElementById('download');
    const status = document.getElementById('status');
    const bar = document.getElementById('bar');

    let gif = null;
    let frame = 0;
    let interval = null;
    const fps = 24;
    const totalFrames = 120; // ~5 gi√¢y
    const frameDelay = 1000 / fps;

    // Kh·ªüi t·∫°o GIF
    function initGIF() {
      gif = new GIF({
        workers: 4,
        quality: 10,
        width: canvas.width,
        height: canvas.height,
        workerScript: 'https://cdn.jsdelivr.net/npm/gif.js@0.2.0/dist/gif.worker.js'
      });

      gif.on('progress', p => {
        bar.style.width = (p * 100) + '%';
      });

      gif.on('finished', blob => {
        const url = URL.createObjectURL(blob);
        downloadBtn.href = url;
        downloadBtn.download = `animation-${Date.now()}.gif`;
        downloadBtn.disabled = false;
        downloadBtn.textContent = '‚¨áÔ∏è T·∫£i GIF v·ªÅ (' + (blob.size / 1024).toFixed(1) + ' KB)';
        status.textContent = 'Ho√†n t·∫•t! Nh·∫•n ƒë·ªÉ t·∫£i.';
        startBtn.disabled = false;
      });
    }

    // V·∫Ω 1 frame
    function drawFrame() {
      // N·ªÅn gradient
      const grad = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      grad.addColorStop(0, '#ff9a9e');
      grad.addColorStop(1, '#fad0c4');
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // H√¨nh tr√≤n di chuy·ªÉn
      const t = frame / totalFrames;
      const x = t * canvas.width;
      const y = canvas.height / 2 + Math.sin(t * Math.PI * 4) * 50;

      ctx.fillStyle = '#fff';
      ctx.beginPath();
      ctx.arc(x, y, 40, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = '#e74c3c';
      ctx.lineWidth = 5;
      ctx.stroke();

      // Text
      ctx.fillStyle = '#333';
      ctx.font = 'bold 24px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Grok GIF Maker', canvas.width / 2, 50);

      // Th√™m frame v√†o GIF
      gif.addFrame(ctx, { copy: true, delay: frameDelay });

      // C·∫≠p nh·∫≠t ti·∫øn tr√¨nh
      bar.style.width = ((frame / totalFrames) * 100) + '%';
      status.textContent = `ƒêang t·∫°o... Frame ${frame}/${totalFrames}`;

      frame++;

      if (frame > totalFrames) {
        clearInterval(interval);
        status.textContent = 'ƒêang render GIF...';
        startBtn.disabled = true;
        gif.render();
      }
    }

    // B·∫Øt ƒë·∫ßu
    startBtn.onclick = () => {
      frame = 0;
      initGIF();
      startBtn.disabled = true;
      downloadBtn.disabled = true;
      downloadBtn.textContent = '‚¨áÔ∏è T·∫£i GIF v·ªÅ';
      status.textContent = 'ƒêang quay...';
      bar.style.width = '0%';
      interval = setInterval(drawFrame, frameDelay);
      drawFrame(); // frame ƒë·∫ßu ti√™n
    };

    // T·∫£i v·ªÅ (n√∫t s·∫Ω t·ª± enable khi xong)
    downloadBtn.onclick = () => {
      // T·ª± ƒë·ªông click link ·∫©n
      downloadBtn.click();
    };
  </script>
</body>
</html>
