<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thiệp 20/11 GIF Mượt</title>
<style>
*{margin:0;padding:0;box-sizing:border-box;}
body{
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    min-height:100vh; font-family:'Times New Roman', serif; padding:20px; gap:18px;
    background-image: url('images/hoalahe.jpg');
    background-size: cover;
    background-repeat: no-repeat;
    background-position: center;
}
.input-group{display:flex;flex-direction:column;gap:8px;width:350px;}
.input-group label{font-weight:bold;color:#cc3333;font-size:1.1em;text-shadow:1px 1px 0 #fff,-1px 1px 0 #fff,1px -1px 0 #fff,-1px -1px 0 #fff;}
.input-group input{padding:12px 16px;font-size:1em;border:2px solid #d89648;border-radius:12px;outline:none;transition:all 0.3s;}
.input-group input:focus{border-color:#cc3333;box-shadow:0 0 8px rgba(204,51,51,0.3);}
.create-button{padding:14px 32px;background:#cc3333;color:white;border:none;border-radius:30px;font-size:1.2em;font-weight:bold;cursor:pointer;box-shadow:0 6px 15px rgba(0,0,0,0.2);transition:all 0.3s;margin-top:10px;}
.create-button:hover{background:#b02a2a;transform:translateY(-2px);}
#cardContainer{position:relative;width:350px;height:350px;margin-top:20px;}
.card-wrapper{width:350px;min-height:300px;position:relative;perspective:1000px;opacity:0;transform:scale(0.8);transition:all 0.6s;}
.card-wrapper.visible{opacity:1;transform:scale(1);}
.card{width:350px;min-height:180px;position:absolute;bottom:0;left:0;background:#fff;border-radius:12px;padding:25px 22px;box-shadow:0 12px 28px rgba(0,0,0,0.18);transform:translateY(100%) scale(0.9);transform-origin:bottom center;transition:all 1.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);opacity:0;z-index:1;backface-visibility:hidden;}
.card-wrapper.active .card{transform:translateY(-160px) scale(1.12);opacity:1;}
.card-content{position:relative;display:flex;flex-direction:column;min-height:100%;}
.card-content h1{color:#cc3333;font-size:2.2em;margin-bottom:14px;border-bottom:3px double #d89648;padding-bottom:6px;text-align:center;z-index:2;}
.greeting-text{margin-top:16px;font-size:1.05em;line-height:1.75;color:#333;text-align:left;padding:0 5px;z-index:2;}
.signature{margin-top:24px;font-style:italic;font-weight:bold;color:#555;text-align:right;padding-right:10px;font-size:1.1em;z-index:2;}
.flower-decoration{position:absolute;width:72px;height:72px;opacity:0.7;z-index:1;}
.flower-decoration::before,.flower-decoration::after{content:'';position:absolute;border-radius:50%;}
.flower-decoration::before{width:38px;height:38px;background:#ff8c00;box-shadow:0 0 12px rgba(255,140,0,0.5);top:50%;left:50%;transform:translate(-50%,-50%);}
.flower-decoration::after{width:46px;height:18px;background:#3cb371;border-radius:0 50% 50% 0;transform:rotate(45deg);top:10px;left:0;}
.flower-top-left{top:12px;left:12px;transform:rotate(-20deg);}
.flower-bottom-right{bottom:12px;right:12px;transform:rotate(160deg);}
.envelope{width:350px;height:250px;position:absolute;bottom:0;left:0;border-radius:12px;z-index:2;transform-style:preserve-3d;}
.envelope::before{content:'';position:absolute;top:0;left:0;width:0;height:0;border-left:175px solid transparent;border-right:175px solid transparent;border-top:125px solid;transform-origin:top;transition:transform 0.2s ease;z-index:3;}
.open-button{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:4;padding:13px 26px;background:#cc3333;color:white;border:none;border-radius:28px;cursor:pointer;font-weight:bold;font-size:1.15em;box-shadow:0 5px 12px rgba(0,0,0,0.22);transition:all 0.3s;}
</style>
</head>
<body>

<div class="input-group">
    <label for="teacherName">Tên Thầy/Cô:</label>
    <input type="text" id="teacherName" placeholder="VD: Cô Lan, Thầy Minh..." value="">
</div>

<button id="createBtn" class="create-button">Tạo Thiệp 20/11</button>

<div id="cardContainer"></div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.js"></script>

<script>
const greetings = [
`"Nhân ngày Nhà giáo Việt Nam, chúng con xin gửi lời tri ân sâu sắc nhất đến {teacher}..."`,
`"{teacher} không chỉ dạy con chữ, mà còn dạy con cách làm người..."`,
`"Kính chúc {teacher} một ngày 20/11 tràn đầy yêu thương..."`
];
const envelopeColors = [
{ base: '#f7b267', flap: '#d89648' },
{ base: '#ffffff', flap: '#f0f0f0' },
{ base: '#ffe4e1', flap: '#ffb6c1' }
];

async function createCard(){
    const teacherName = document.getElementById('teacherName').value.trim() || "Thầy/Cô";
    const container = document.getElementById('cardContainer');
    container.innerHTML = "";
    const greeting = greetings[Math.floor(Math.random()*greetings.length)].replace(/{teacher}/g, teacherName);
    const color = envelopeColors[Math.floor(Math.random()*envelopeColors.length)];

    container.innerHTML = `
    <div class="card-wrapper visible" id="cardWrapper">
        <div class="card" id="card">
            <div class="card-content">
                <div class="flower-decoration flower-top-left"></div>
                <div class="flower-decoration flower-bottom-right"></div>
                <h1>Kính Chúc Mừng 20/11</h1>
                <p class="greeting-text">${greeting}</p>
            </div>
        </div>
        <div class="envelope" style="background-color:${color.base}">
        </div>
    </div>
    <style>#cardWrapper .envelope::before{border-top-color:${color.flap} !important;}</style>`;

    const wrapper = document.getElementById('cardWrapper');

    // Tạo GIF
    const gif = new GIF({workers:2, quality:10});
    const totalFrames = 10; // số frame mở phong bì
    for(let i=0;i<=totalFrames;i++){
        // set transform
        wrapper.querySelector('.envelope').style.transform = `rotateX(${i*(180/totalFrames)}deg)`;
        const canvas = await html2canvas(wrapper);
        gif.addFrame(canvas,{delay:150});
    }

    gif.on('finished', function(blob){
        const url = URL.createObjectURL(blob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `thiep.gif`;
        link.click();
    });

    gif.render();
}

document.getElementById('createBtn').onclick = createCard;
</script>

</body>
</html>
