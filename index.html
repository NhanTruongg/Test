<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thiệp 20/11 GIF Animation</title>
<style>
body{
    display:flex;flex-direction:column;align-items:center;justify-content:center;
    min-height:100vh;font-family:'Times New Roman',serif;
    background:#f0f0f0;padding:20px;
}
.input-group{display:flex;flex-direction:column;gap:8px;width:350px;margin-bottom:20px;}
.input-group label{font-weight:bold;color:#cc3333;text-shadow:1px 1px 0 #fff,-1px 1px 0 #fff,1px -1px 0 #fff,-1px -1px 0 #fff;}
.input-group input{padding:12px;font-size:1em;border:2px solid #d89648;border-radius:12px;outline:none;}
.create-button,.download-button{padding:14px 32px;border:none;border-radius:30px;font-size:1.2em;font-weight:bold;color:white;cursor:pointer;margin:5px;}
.create-button{background:#cc3333;box-shadow:0 6px 15px rgba(0,0,0,0.2);}
.create-button:hover{background:#b02a2a;}
.download-button{background:#3cb371;opacity:0;pointer-events:none;}
.download-button.visible{opacity:1;pointer-events:auto;}
#cardContainer{position:relative;width:350px;height:350px;}
.card-wrapper{position:absolute;width:350px;height:250px;perspective:1000px;}
.card{width:350px;height:180px;background:white;border-radius:12px;position:absolute;bottom:0;left:0;display:flex;flex-direction:column;justify-content:center;align-items:center;padding:20px;box-shadow:0 8px 20px rgba(0,0,0,0.2);opacity:0;}
.card h1{color:#cc3333;text-align:center;margin-bottom:10px;}
.card p{color:#333;text-align:center;font-size:1em;}
.envelope{width:350px;height:250px;position:absolute;bottom:0;left:0;border-radius:12px;background:#f7b267;transform-origin:top center;}
.envelope::before{content:'';position:absolute;top:0;left:0;width:0;height:0;border-left:175px solid transparent;border-right:175px solid transparent;border-top:125px solid #d89648;transform-origin:top center;}
</style>
</head>
<body>

<div class="input-group">
    <label for="teacherName">Tên Thầy/Cô:</label>
    <input type="text" id="teacherName" placeholder="VD: Cô Lan, Thầy Minh..." value="">
</div>

<button id="createBtn" class="create-button">Tạo GIF Thiệp</button>
<button id="downloadBtn" class="download-button">Tải GIF</button>

<div id="cardContainer"></div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.js"></script>

<script>
const greetings = [
`"Nhân ngày Nhà giáo Việt Nam, chúng con xin gửi lời tri ân sâu sắc nhất đến {teacher} – người lái đò thầm lặng!"`,
`"{teacher} không chỉ dạy con chữ, mà còn dạy con cách làm người!"`,
`"Kính chúc {teacher} một ngày 20/11 tràn đầy yêu thương!"`
];

document.getElementById('createBtn').onclick = async () => {
    const teacher = document.getElementById('teacherName').value.trim() || "Thầy/Cô";
    const container = document.getElementById('cardContainer');
    container.innerHTML = "";

    const greeting = greetings[Math.floor(Math.random()*greetings.length)].replace(/{teacher}/g, teacher);

    // Tạo HTML
    container.innerHTML = `
    <div class="card-wrapper" id="cardWrapper">
        <div class="card" id="card">
            <h1>Kính Chúc Mừng 20/11</h1>
            <p>${greeting}</p>
        </div>
        <div class="envelope" id="envelope"></div>
    </div>
    `;

    const wrapper = document.getElementById('cardWrapper');
    const card = document.getElementById('card');
    const envelope = document.getElementById('envelope');

    // Tạo GIF
    const gif = new GIF({workers:2, quality:10});

    const totalFrames = 15;

    for(let i=0;i<=totalFrames;i++){
        const openDeg = i*(180/totalFrames);
        envelope.style.transform = `rotateX(${openDeg}deg)`;
        card.style.opacity = (i/totalFrames);
        card.style.transform = `translateY(${-i*2}px)`; // thiệp bay lên
        if(i>totalFrames*0.8){ // phong bì biến mất cuối animation
            envelope.style.opacity = (1-(i-totalFrames*0.8)/(totalFrames*0.2));
        }
        const canvas = await html2canvas(wrapper);
        gif.addFrame(canvas,{delay:100});
    }

    gif.on('finished', function(blob){
        const downloadBtn = document.getElementById('downloadBtn');
        downloadBtn.href = URL.createObjectURL(blob);
        downloadBtn.download = `thiep_2011.gif`;
        downloadBtn.classList.add('visible');
    });

    gif.render();
};
</script>

</body>
</html>
