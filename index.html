<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Thiệp 20/11 - Nhập Tên & Tải GIF</title>
<style>
* { margin:0; padding:0; box-sizing:border-box; }
body {
    display:flex; flex-direction:column; justify-content:center; align-items:center;
    min-height:100vh; font-family:'Times New Roman', serif; padding:20px; gap:18px;
    background-image:url('images/hoalahe.jpg');
    background-size:cover; background-repeat:no-repeat; background-position:center;
}
.input-group { display:flex; flex-direction:column; gap:8px; width:350px; }
.input-group label { font-weight:bold; color:#cc3333; font-size:1.1em;
    text-shadow:1px 1px 0 #fff,-1px 1px 0 #fff,1px -1px 0 #fff,-1px -1px 0 #fff; }
.input-group input { padding:12px 16px; font-size:1em; border:2px solid #d89648; border-radius:12px; outline:none; }
.input-group input:focus { border-color:#cc3333; box-shadow:0 0 8px rgba(204,51,51,0.3); }

.create-button, .download-button { padding:14px 32px; border:none; border-radius:30px; font-size:1.2em; font-weight:bold; color:white; cursor:pointer; margin:5px; }
.create-button { background:#cc3333; box-shadow:0 6px 15px rgba(0,0,0,0.2); }
.create-button:hover { background:#b02a2a; }
.download-button { background:#3cb371; opacity:0; pointer-events:none; }
.download-button.visible { opacity:1; pointer-events:auto; }

#cardContainer { position:relative; width:350px; height:350px; }
.card-wrapper { position:absolute; width:350px; height:250px; perspective:1000px; }
.card { width:350px; min-height:180px; position:absolute; bottom:0; left:0; background:#fff; border-radius:12px; padding:25px 22px; box-shadow:0 12px 28px rgba(0,0,0,0.18); transform:translateY(100%) scale(0.9); transform-origin:bottom center; transition:all 1.5s cubic-bezier(0.175,0.885,0.32,1.275); opacity:0; z-index:1; backface-visibility:hidden; }
.card-wrapper.active .card { transform:translateY(-160px) scale(1.12); opacity:1; }
.card-content { position:relative; display:flex; flex-direction:column; min-height:100%; }
.card-content h1 { color:#cc3333; font-size:2.2em; margin-bottom:14px; border-bottom:3px double #d89648; padding-bottom:6px; text-align:center; z-index:2; }
.greeting-text { margin-top:16px; font-size:1.05em; line-height:1.75; color:#333; text-align:left; padding:0 5px; z-index:2; }

.envelope { width:350px; height:250px; position:absolute; bottom:0; left:0; border-radius:12px; z-index:2; transition:all 1.5s ease; transform-style:preserve-3d; }
.envelope::before { content:''; position:absolute; top:0; left:0; width:0; height:0; border-left:175px solid transparent; border-right:175px solid transparent; border-top:125px solid; transform-origin:top; transition:transform 0.6s ease 0.7s; z-index:3; }

.open-button { position:absolute; top:50%; left:50%; transform:translate(-50%, -50%); z-index:4; padding:13px 26px; background:#cc3333; color:white; border:none; border-radius:28px; cursor:pointer; font-weight:bold; font-size:1.15em; box-shadow:0 5px 12px rgba(0,0,0,0.22); transition:all 0.3s; }
.open-button:hover { background:#b02a2a; transform:translate(-50%,-50%) scale(1.08); }
.card-wrapper.active .open-button { opacity:0; pointer-events:none; }
</style>
</head>
<body>

<div class="input-group">
    <label for="teacherName">Tên Thầy/Cô:</label>
    <input type="text" id="teacherName" placeholder="VD: Cô Lan, Thầy Minh..." value="">
</div>

<button id="createBtn" class="create-button">Tạo GIF Thiệp</button>
<a id="downloadBtn" class="download-button">Tải GIF</a>

<div id="cardContainer"></div>

<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/gif.js.optimized/dist/gif.js"></script>

<script>
const greetings=[
`"Nhân ngày Nhà giáo Việt Nam, chúng con xin gửi lời tri ân sâu sắc đến {teacher}!"`,
`"{teacher} không chỉ dạy con chữ, mà còn dạy con cách làm người!"`,
`"Kính chúc {teacher} một ngày 20/11 tràn đầy yêu thương!"`
];

const envelopeColors = [
    { base:'#f7b267', flap:'#d89648' },
    { base:'#ffffff', flap:'#f0f0f0' },
    { base:'#ffe4e1', flap:'#ffb6c1' }
];

let currentCardWrapper=null;

function createCard(){
    const teacherName=document.getElementById('teacherName').value.trim()||"Thầy/Cô";
    const container=document.getElementById('cardContainer');
    const createBtn=document.getElementById('createBtn');
    const downloadBtn=document.getElementById('downloadBtn');
    createBtn.style.display='none';

    let greeting=greetings[Math.floor(Math.random()*greetings.length)].replace(/{teacher}/g,teacherName);
    const color=envelopeColors[Math.floor(Math.random()*envelopeColors.length)];

    container.innerHTML=`
    <div class="card-wrapper visible" id="cardWrapper">
        <div class="card" id="card">
            <div class="card-content">
                <h1>Kính Chúc Mừng 20/11</h1>
                <p class="greeting-text">${greeting}</p>
            </div>
        </div>
        <div class="envelope" style="background-color:${color.base}">
            <button class="open-button">Mở Phong Bì</button>
        </div>
    </div>
    <style>#cardWrapper .envelope::before{border-top-color:${color.flap}!important;}</style>
    `;
    currentCardWrapper=document.getElementById('cardWrapper');

    // Animation + tạo GIF
    setTimeout(async ()=>{
        const openBtn=document.querySelector('.open-button');
        openBtn.onclick=async ()=>{
            const wrapper=document.getElementById('cardWrapper');
            const card=document.getElementById('card');
            wrapper.classList.add('active');

            const gif=new GIF({workers:2, quality:10});
            const frames=15;
            for(let i=0;i<=frames;i++){
                // Mở phong bì + thiệp hiện
                const deg=i*(180/frames);
                const opacity=i/frames;
                document.querySelector('.envelope').style.transform=`rotateX(${deg}deg)`;
                card.style.opacity=opacity;
                card.style.transform=`translateY(${-i*2}px)`;
                if(i>frames*0.8){
                    document.querySelector('.envelope').style.opacity=`${1-(i-frames*0.8)/(frames*0.2)}`;
                }
                const canvas=await html2canvas(wrapper);
                gif.addFrame(canvas,{delay:100});
            }

            gif.on('finished',function(blob){
                downloadBtn.href=URL.createObjectURL(blob);
                downloadBtn.download=`Thiep-2011.gif`;
                downloadBtn.classList.add('visible');
            });
            gif.render();
        };
    },100);
}

document.getElementById('createBtn').onclick=createCard;
</script>
</body>
</html> 
