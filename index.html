<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Grok GIF Maker</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e3c72, #2a5298);
      color: white;
      text-align: center;
      padding: 40px 20px;
      min-height: 100vh;
    }
    h1 { font-size: 2.5rem; margin-bottom: 20px; text-shadow: 0 4px 10px rgba(0,0,0,0.3); }
    canvas {
      border: 4px solid rgba(255,255,255,0.3);
      border-radius: 20px;
      box-shadow: 0 15px 30px rgba(0,0,0,0.4);
      max-width: 100%;
      height: auto;
    }
    .controls { margin: 30px 0; }
    button {
      padding: 16px 32px;
      font-size: 1.2rem;
      font-weight: bold;
      background: #00d2ff;
      color: #000;
      border: none;
      border-radius: 50px;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0,210,255,0.4);
      transition: all 0.3s;
    }
    button:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 12px 25px rgba(0,210,255,0.6); }
    button:disabled { background: #666; cursor: not-allowed; transform: none; }
    .status {
      margin: 20px 0;
      font-size: 1.1rem;
      min-height: 30px;
    }
    .progress {
      width: 70%; max-width: 500px; height: 12px; background: rgba(255,255,255,0.2);
      margin: 20px auto; border-radius: 6px; overflow: hidden;
    }
    .bar { height: 100%; width: 0%; background: #00d2ff; border-radius: 6px; transition: width 0.2s; }
  </style>
</head>
<body>
  <h1>üöÄ Grok GIF Maker</h1>
  <p>T·∫°o GIF t·ª´ HTML/CSS/JS ‚Äì T·∫£i v·ªÅ ngay!</p>
  <canvas id="canvas" width="600" height="400"></canvas>

  <div class="controls">
    <button id="start">üé¨ T·∫†O GIF NGAY</button>
  </div>

  <div class="progress"><div class="bar" id="bar"></div></div>
  <div class="status" id="status">S·∫µn s√†ng ‚Äì Nh·∫•n n√∫t ƒë·ªÉ b·∫Øt ƒë·∫ßu</div>

  <!-- gif.js t·∫£i t·ª´ c√πng repo -->
  <script src="gif.js"></script>

  <script>
    const canvas = document.getElementById('canvas');
    const ctx = canvas.getContext('2d');
    const startBtn = document.getElementById('start');
    const status = document.getElementById('status');
    const bar = document.getElementById('bar');

    let gif, frame = 0, totalFrames = 144, fps = 24;
    const delay = 1000 / fps;

    startBtn.onclick = () => {
      frame = 0;
      bar.style.width = '0%';
      status.textContent = 'ƒêang quay animation...';
      startBtn.disabled = true;
      initGIF();
      requestAnimationFrame(drawFrame);
    };

    function initGIF() {
      gif = new GIF({
        workers: 4,
        quality: 5,
        width: canvas.width,
        height: canvas.height
      });

      gif.on('progress', p => {
        bar.style.width = (p * 100) + '%';
      });

      gif.on('finished', blob => {
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `grok-gif-${Date.now()}.gif`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);

        status.innerHTML = `Ho√†n t·∫•t! ƒê√£ t·∫£i t·ª± ƒë·ªông.<br>K√≠ch th∆∞·ªõc: <strong>${(blob.size/1024).toFixed(1)} KB</strong>`;
        startBtn.disabled = false;
      });
    }

    function drawFrame() {
      const t = frame / totalFrames;

      // N·ªÅn chuy·ªÉn m√†u
      const grad = ctx.createLinearGradient(0, 0, canvas.width, canvas.height);
      grad.addColorStop(0, `hsl(${(t * 360 + 200) % 360}, 80%, 60%)`);
      grad.addColorStop(1, `hsl(${(t * 360 + 260) % 360}, 80%, 60%)`);
      ctx.fillStyle = grad;
      ctx.fillRect(0, 0, canvas.width, canvas.height);

      // H√¨nh tr√≤n bay
      const x = 100 + t * (canvas.width - 200);
      const y = canvas.height / 2 + Math.sin(t * Math.PI * 8) * 100;

      ctx.fillStyle = 'rgba(255,255,255,0.9)';
      ctx.beginPath();
      ctx.arc(x, y, 60, 0, Math.PI * 2);
      ctx.fill();
      ctx.strokeStyle = '#fff';
      ctx.lineWidth = 6;
      ctx.stroke();

      // Logo text
      ctx.fillStyle = '#000';
      ctx.font = 'bold 48px Arial';
      ctx.textAlign = 'center';
      ctx.fillText('Grok', canvas.width / 2, 100);

      // Th√™m frame
      gif.addFrame(ctx, { copy: true, delay });

      // C·∫≠p nh·∫≠t ti·∫øn tr√¨nh
      const progress = frame / totalFrames;
      bar.style.width = (progress * 100) + '%';
      status.textContent = `ƒêang t·∫°o... ${frame}/${totalFrames} frames`;

      frame++;
      if (frame <= totalFrames) {
        setTimeout(() => requestAnimationFrame(drawFrame), delay);
      } else {
        status.textContent = 'ƒêang render GIF...';
        gif.render();
      }
    }
  </script>
</body>
</html>
